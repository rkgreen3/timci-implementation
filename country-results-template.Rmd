---
title: "Implementation Study Analysis"
output: html_document
date: "`r Sys.Date()`"
output:
  html_document:
    toc: TRUE
    toc_float: TRUE
    theme: flatly
---


# Background

The overall goal of thdf_og project df_og to reduce morbidity and mortality of sick children attending primary care facilities while supporting the rational and efficient use of diagnostics and medicines by healthcare providers. Thdf_og study df_og focused on understanding the operational feasibility of multimodal pulse ox use in standard care. The results presented in thdf_og document describe several weeks of use of the Masimo pulse oximeter in primary care settings.

```{r setup, include=FALSE}
rm(ldf_ogt=ls())

knitr::opts_chunk$set(echo = FALSE)

# install these packages if not already on your computer
library(plyr)
library(dplyr)
library(tableone)
library(kableExtra)
library(epiDisplay)
library(Hmisc)


# Read in (cleaned) data
# Create a text file from within R with the name ".Renviron", then define the variables as below
# filename = "<current-file-name>.csv"
# COUNTRY = "<your-country>"
# After adding the file and content restart R session and you are good to go
# The Renviron will be ignored when pushing changes to Github


df_og <- read.csv(file.choose())

describe(df_og$country)
# Define country and subset
COUNTRY <- Sys.getenv("COUNTRY")
df_sn <- subset(df_og, df_og$country=="Senegal")

```

# Table 1: Patient demographic and household characterdf_ogtics.

```{r}
#CARACTERISTIQUES 

## Sex

df_sn$sex=as.factor(df_sn$sex)
describe(df_sn$sex)
tabpct(df_sn$facility_name,df_sn$sex)

## Relationship of caregiver to child

df_sn$cg_relationship = as.factor(df_sn$cg_relationship)
describe(df_sn$cg_relationship)
tabpct(df_sn$facility_name,df_sn$cg_relationship)

## Maternal education

df_sn$cg_edu_mother=as.factor(df_sn$cg_edu_mother)
describe(df_sn$cg_edu_mother)
tabpct(df_sn$facility_name,df_sn$cg_edu_mother)

## Household head

df_sn$household_head=as.factor(df_sn$household_head)
describe(df_sn$household_head)
tabpct(df_sn$facility_name,df_sn$household_head)

## Household toilet

df_sn$household_toilet=as.factor(df_sn$household_toilet)
describe(df_sn$household_toilet)
tabpct(df_sn$facility_name,df_sn$household_toilet)

## Household fuel

df_sn$household_fuel=as.factor(df_sn$household_fuel)
describe(df_sn$household_fuel)
tabpct(df_sn$facility_name,df_sn$household_fuel)

## Household water located in house

df_sn$household_water_loc=as.factor(df_sn$household_water_loc)
describe(df_sn$household_water_loc)
tabpct(df_sn$facility_name,df_sn$household_water_loc)

## Household floor

df_sn$household_floor=as.factor(df_sn$household_floor)
describe(df_sn$household_floor)
tabpct(df_sn$facility_name,df_sn$household_floor)

```


# Table 2: Patient clinical and care seeking characterdf_sntics.

```{r}

## Reason for visit to clinic
df_sn$facility_choice_reason___2 = as.factor(df_sn$facility_choice_reason___2)
describe(df_sn$facility_choice_reason___2)
tabpct(df_sn$facility_name,df_sn$facility_choice_reason___2)

df_sn$facility_choice_reason___3 = as.factor(df_sn$facility_choice_reason___3)
describe(df_sn$facility_choice_reason___3)
tabpct(df_sn$facility_name,df_sn$facility_choice_reason___3)

df_sn$facility_choice_reason___4 = as.factor(df_sn$facility_choice_reason___4)
describe(df_sn$facility_choice_reason___4)
tabpct(df_sn$facility_name,df_sn$facility_choice_reason___4)

df_sn$facility_choice_reason___5 = as.factor(df_sn$facility_choice_reason___5)
describe(df_sn$facility_choice_reason___5)
tabpct(df_sn$facility_name,df_sn$facility_choice_reason___5)

df_sn$facility_choice_reason___8 = as.factor(df_sn$facility_choice_reason___8)
describe(df_sn$facility_choice_reason___8)
tabpct(df_sn$facility_name,df_sn$facility_choice_reason___8)

## ## Mode of travel to clinic

df_sn$travel_mode___1=as.factor(df_sn$travel_mode___1)
describe(df_sn$travel_mode___1)
tabpct(df_sn$facility_name,df_sn$travel_mode___1)

df_sn$travel_mode___2=as.factor(df_sn$travel_mode___2)
describe(df_sn$travel_mode___2)

df_sn$travel_mode___3=as.factor(df_sn$travel_mode___3)
describe(df_sn$travel_mode___3)
tabpct(df_sn$facility_name,df_sn$travel_mode___3)

df_sn$travel_mode___4=as.factor(df_sn$travel_mode___4)
describe(df_sn$travel_mode___4)

df_sn$travel_mode___5=as.factor(df_sn$travel_mode___5)
describe(df_sn$travel_mode___5)

df_sn$travel_mode___6=as.factor(df_sn$travel_mode___6)
describe(df_sn$travel_mode___6)
tabpct(df_sn$facility_name,df_sn$travel_mode___6)

df_sn$travel_mode___7=as.factor(df_sn$travel_mode___7)
describe(df_sn$travel_mode___7)
tabpct(df_sn$facility_name,df_sn$travel_mode___7)

df_sn$travel_mode___8=as.factor(df_sn$travel_mode___8)
describe(df_sn$travel_mode___8)
tabpct(df_sn$facility_name,df_sn$travel_mode___8)

df_sn$travel_mode___9=as.factor(df_sn$travel_mode___9)
describe(df_sn$travel_mode___9)
tabpct(df_sn$facility_name,df_sn$travel_mode___9)

df_sn$travel_mode___10=as.factor(df_sn$travel_mode___10)
describe(df_sn$travel_mode___10)
tabpct(df_sn$facility_name,df_sn$travel_mode___10)

df_sn$travel_mode___11=as.factor(df_sn$travel_mode___11)
describe(df_sn$travel_mode___11)
tabpct(df_sn$facility_name,df_sn$travel_mode___11)

df_sn$travel_mode___999=as.factor(df_sn$travel_mode___999)
describe(df_sn$travel_mode___999)
tabpct(df_sn$facility_name,df_sn$travel_mode___999)

## Travel time to arrive at clinic

df_sn$travel_time=as.factor(df_sn$travel_time)
describe(df_sn$travel_time)
tabpct(df_sn$facility_name,df_sn$travel_time)

## Estimated amount of money spent for transport to arrive at clinic (USD)

df_sn$travel_cost=as.factor(df_sn$travel_cost)
describe(df_sn$travel_cost)
tabpct(df_sn$facility_name,df_sn$travel_cost)
```


# Table 3: Use of PO device across facilities.

```{r}

## PO device used during encounter

df_sn$used_po_yn=as.factor(df_sn$used_po_yn)
describe(df_sn$used_po_yn)

## PO device used correctly

df_sn$correct_use_yn=as.factor(df_sn$correct_use_yn)
describe(df_sn$correct_use_yn)
tabpct(df_sn$facility_name,df_sn$correct_use_yn)

## Duration of PO device use

df_sn$duration_po =difftime(df_sn$po_stop,df_sn$po_start, units = "mins")
print(df_sn$duration_po)
df_sn$duration_po=as.numeric(df_sn$duration_po)
summ(df_sn$duration_po)
df_sn$duration_po_1 = cut(df_sn$duration_po,
                       breaks = c(0,1,3.1,5.1,10.1,30.1,60),
                       right = F,
                       labels = c("Moins une min","1 Ã  3 m","4-5m","6-10m","11-30","31-60"))
describe(df_sn$duration_po_1)
tabpct(df_sn$facility_name,df_sn$duration_po_1)

## Consultation duration
df_sn$consult_start=as.POSIXlt(df_sn$consult_start, format = "%H:%M")
df_sn$consult_stop=as.POSIXct(df_sn$consult_stop, format = "%H:%M")
df_sn$consultation_duration = difftime(df_sn$consult_stop,df_sn$consult_start,units = "mins")
print(df_sn$consultation_duration)
df_sn$consultation_duration=as.numeric(df_sn$consultation_duration)
summ(df_sn$consultation_duration)
df_sn$consultation_duration_1 = cut(df_sn$consultation_duration,
                       breaks = c(0,2.1,5.1,10.1,30.1,60.1,100),
                       right = F,
                       labels = c("2 min","3-5m","6-10m","11-30","31-60","Plus 60"))
describe(df_sn$consultation_duration_1)
tabpct(df_sn$facility_name,df_sn$consultation_duration_1)

## Encounters where all clinical measurements were assessed

df_sn$correct_use_measurements = df_sn$correct_use_measurements___1 + df_sn$correct_use_measurements___2 +
  df_sn$correct_use_measurements___3 + df_sn$correct_use_measurements___4
df_sn$correct_use_measurements=as.factor(df_sn$correct_use_measurements)
describe(df_sn$correct_use_measurements)
tabpct(df_sn$facility_name,df_sn$correct_use_measurements)

```


# Table 4: Clinical outcomes following implementation of PO device.
